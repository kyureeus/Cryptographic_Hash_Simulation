<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptographic Hash Lab (SHA-256)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load html2canvas for image/PDF download functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Custom scrollbar styling for the hash output */
        ::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(100, 116, 139, 0.5); /* slate-500 equivalent */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5); /* slate-100 equivalent */
        }
        /* Styling for the report area before download */
        #report-output {
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* Custom font */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10 p-6 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-2">Cryptographic Hash Function Lab</h1>
            <p class="text-gray-600">Explore the properties of SHA-256: Fixed output size, one-way function, and the avalanche effect.</p>
        </header>

        <!-- Student Info and Controls -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-1">
                <label for="student-name" class="block text-sm font-medium text-gray-700">Student Name</label>
                <input type="text" id="student-name" placeholder="Enter Your Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>
            <div class="md:col-span-1">
                <label for="roll-number" class="block text-sm font-medium text-gray-700">Roll Number / ID</label>
                <input type="text" id="roll-number" placeholder="e.g., A20251234" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>
            <div class="md:col-span-1 flex items-end">
                <button onclick="downloadReport()" id="download-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out disabled:opacity-50">
                    Download Lab Report (PNG)
                </button>
            </div>
        </div>
        
        <!-- Main Simulation Area -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Input Data (Message)</h2>
            <textarea id="input-data" rows="6" placeholder="Type or paste any text here. Observe how the hash changes with even a single character difference (Avalanche Effect)." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 mb-4 text-sm"></textarea>
            
            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <button onclick="calculateHash()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                    Calculate SHA-256 Hash
                </button>
                <button onclick="clearInputs()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                    Clear Inputs
                </button>
            </div>

            <!-- Hash Output Section -->
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Output Hash (Fingerprint)</h2>
            <div id="hash-output" class="bg-gray-100 p-4 rounded-lg border border-gray-300 text-gray-800 font-mono break-all text-sm whitespace-normal overflow-x-auto">
                [The SHA-256 hash will appear here (fixed 64 characters)]
            </div>
            <p class="text-xs text-gray-500 mt-2">The length of the output hash is always 256 bits (64 hexadecimal characters), regardless of the input size.</p>
        </div>

        <!-- Hidden Report Capture Area -->
        <div id="report-container" class="mt-8 hidden">
            <div id="lab-report-card">
                <div id="report-output" class="p-6">
                    <h3 class="text-2xl font-bold text-indigo-700 border-b-2 border-indigo-200 pb-2 mb-4">Cryptographic Hash Lab Assignment Report</h3>
                    
                    <div class="mb-4 space-y-2 text-gray-700">
                        <p><strong>Student Name:</strong> <span id="report-name" class="font-medium">N/A</span></p>
                        <p><strong>Roll Number / ID:</strong> <span id="report-roll" class="font-medium">N/A</span></p>
                        <p><strong>Date:</strong> <span id="report-date" class="font-medium"></span></p>
                    </div>

                    <h4 class="text-lg font-semibold text-gray-800 mt-6 mb-2">1. Input Message Used</h4>
                    <pre id="report-input-data" class="bg-gray-50 p-3 rounded-md border border-gray-200 text-sm whitespace-pre-wrap">[No message calculated yet]</pre>
                    
                    <h4 class="text-lg font-semibold text-gray-800 mt-6 mb-2">2. Generated SHA-256 Hash</h4>
                    <p id="report-hash-output" class="bg-gray-50 p-3 rounded-md border border-gray-200 text-sm font-mono break-all">[No hash calculated yet]</p>

                    <h4 class="text-lg font-semibold text-gray-800 mt-6 mb-2">3. Observations</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                        <li>The hash output size is fixed at 64 hexadecimal characters (256 bits).</li>
                        <li>Even a small change in the input resulted in a completely different hash (Avalanche Effect).</li>
                    </ul>

                    <p class="text-xs text-center text-gray-400 mt-8">Lab simulated using the browser's native cryptographic module.</p>
                </div>
            </div>
        </div>

        <!-- Message Box for Feedback -->
        <div id="message-box" class="fixed bottom-4 right-4 bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg shadow-xl hidden transition-opacity duration-300" role="alert">
            <span id="message-text"></span>
        </div>
    </div>

    <script>
        // Global utility to show temporary messages
        function showMessage(text, type = 'success') {
            const box = document.getElementById('message-box');
            const textElement = document.getElementById('message-text');
            
            // Define styles based on type
            let bg, border, text_color;
            if (type === 'error') {
                bg = 'bg-red-100'; border = 'border-red-400'; text_color = 'text-red-700';
            } else if (type === 'warning') {
                bg = 'bg-yellow-100'; border = 'border-yellow-400'; text_color = 'text-yellow-700';
            } else { // success / info
                bg = 'bg-green-100'; border = 'border-green-400'; text_color = 'text-green-700';
            }

            // Apply styles and set text
            box.className = `fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-xl transition-opacity duration-300 ${bg} ${border} ${text_color}`;
            textElement.textContent = text;
            
            // Show and hide
            box.classList.remove('hidden', 'opacity-0');
            box.classList.add('opacity-100');
            
            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0');
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 3000);
        }

        /**
         * Converts a string message into a SHA-256 hash (hex string).
         * Uses the browser's native Web Crypto API.
         * @param {string} message - The input data to hash.
         * @returns {Promise<string>} - The resulting SHA-256 hash as a hex string.
         */
        async function sha256(message) {
            try {
                // Encode the message to an ArrayBuffer
                const msgBuffer = new TextEncoder().encode(message);
                
                // Hash the message
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                
                // Convert ArrayBuffer to Array
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                
                // Convert bytes to hex string (64 characters)
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                
                return hashHex;
            } catch (error) {
                console.error("Hashing failed:", error);
                showMessage("Hashing failed. Check browser console for details.", 'error');
                return null;
            }
        }

        /**
         * Handles the button click to calculate and display the hash.
         */
        async function calculateHash() {
            const inputData = document.getElementById('input-data').value;
            const outputElement = document.getElementById('hash-output');

            if (!inputData) {
                showMessage("Please enter some data in the input message field.", 'warning');
                outputElement.textContent = "[The SHA-256 hash will appear here (fixed 64 characters)]";
                return;
            }

            // Show a temporary loading state
            outputElement.innerHTML = '<span class="animate-pulse text-indigo-500">Calculating...</span>';

            const hash = await sha256(inputData);

            if (hash) {
                outputElement.textContent = hash;
                showMessage("Hash successfully calculated!", 'success');
            } else {
                outputElement.textContent = "[Error calculating hash]";
            }
        }

        /**
         * Clears all input fields and the hash output.
         */
        function clearInputs() {
            document.getElementById('student-name').value = '';
            document.getElementById('roll-number').value = '';
            document.getElementById('input-data').value = '';
            document.getElementById('hash-output').textContent = "[The SHA-256 hash will appear here (fixed 64 characters)]";
            showMessage("Simulation cleared.", 'info');
        }

        /**
         * Populates the hidden report card and triggers the PNG download.
         */
        function downloadReport() {
            const name = document.getElementById('student-name').value.trim();
            const roll = document.getElementById('roll-number').value.trim();
            const inputData = document.getElementById('input-data').value;
            const hashOutput = document.getElementById('hash-output').textContent;
            const date = new Date().toLocaleDateString();

            if (!name || !roll) {
                showMessage("Please enter your Name and Roll Number/ID before downloading the report.", 'error');
                return;
            }

            if (hashOutput.startsWith('[') || hashOutput.startsWith('C')) {
                showMessage("Please calculate the hash for your message first.", 'error');
                return;
            }

            // 1. Update the report card content
            document.getElementById('report-name').textContent = name;
            document.getElementById('report-roll').textContent = roll;
            document.getElementById('report-date').textContent = date;
            document.getElementById('report-input-data').textContent = inputData.length > 500 ? inputData.substring(0, 500) + '... (Message truncated in report)' : inputData;
            document.getElementById('report-hash-output').textContent = hashOutput;

            // 2. Prepare the report container for capture (make it visible in the DOM flow temporarily)
            const reportContainer = document.getElementById('lab-report-card');
            reportContainer.parentElement.classList.remove('hidden'); // Show the parent container

            showMessage("Generating report image...", 'info');
            
            // 3. Use html2canvas to render the div as a canvas/image
            html2canvas(reportContainer, { 
                scale: 2, // Increase scale for better resolution
                useCORS: true 
            }).then(canvas => {
                // 4. Create a downloadable link for the PNG image
                const imgData = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                
                // Sanitize file name
                const fileName = `HashLab_Report_${roll.replace(/[^a-zA-Z0-9]/g, '')}_${name.replace(/[^a-zA-Z0-9]/g, '')}.png`;
                
                link.href = imgData;
                link.download = fileName;
                
                // 5. Simulate click to trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 6. Hide the report container again
                reportContainer.parentElement.classList.add('hidden');

                showMessage("Report downloaded as PNG!", 'success');

            }).catch(err => {
                console.error("Error generating image:", err);
                // Hide the container even if it fails
                reportContainer.parentElement.classList.add('hidden'); 
                showMessage("Download failed. Could not generate the report image.", 'error');
            });
        }
    </script>
</body>
</html>
